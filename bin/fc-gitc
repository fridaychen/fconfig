#!/bin/bash

source $FCHOME/bash/lib.sh

repo_root=$(pwd)
branch=
status=true

function usage() {
    cat <<-EOF
Usage:  ${0##*/} [OPTION]
    Dump git repository state summary.

    -b target branch name
    -h usage
    -r repo root path
    -S suppress state summary
EOF

    exit
}

while getopts "b:hr:S" OPTION; do
    case $OPTION in
        b)
            branch=$OPTARG
            ;;

        h)
            usage
            ;;

        r)
            repo_root=$OPTARG
            ;;

        S)
            status=false
            ;;
    esac
done

output=

if [[ ! -z $branch ]]; then
    current=$(fit-current-branch)

    if [[ ${current} != ${branch} ]]; then
        output+="î‚  ${current}"
    fi
fi

if [[ $status == true ]]; then
    count=$(fit-count-changes)

    if [[ count -ne 0 ]]; then
        output+="[$count]"
    fi
fi

if [[ ! -z $output ]]; then
    echo -n "project"
    ansi-format $ANSI_HIGHLIGHT $ANSI_BLUE $ANSI_BLACK " %s" "${repo_root}"
    ansi-format $ANSI_HIGHLIGHT $ANSI_RED $ANSI_BLACK " %s""${output}"
fi
